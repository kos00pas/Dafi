# Dynamic Analysis for OpenThread Network Interoperability Testing
## Dynamic Analysis for Interoperability (DAfI)
Dynamic analysis evaluates a system's real-time behavior and performance during execution.  
This approach, also known as Dynamic Program Analysis or Dynamic Application Security Testing (DAST), is essential for identifying interoperability challenges, protocol bottlenecks, and hardware efficiency in a live OpenThread network environment.

---

## Focus
Inspect how the OpenThread mesh network dynamically adapts and maintains stable operations under:
- Node role transitions (e.g., Router ↔ End Device, Leader elections).
- Topology changes (scaling up/down, adding/removing nodes).

### Simultaneously, we evaluate OpenThread's protocol-level performance:
- IPv6 Handling: Validate OpenThread’s ability to correctly assign, route, and forward IPv6 packets while optimizing overhead through 6LoWPAN header compression.
- RPL Routing Stability: Ensure routing decisions remain adaptive and consistent under network dynamics.
- 6LoWPAN Efficiency: Evaluate how OpenThread compresses and efficiently transmits IPv6 packets over constrained networks.
- Seamless Communication: Measure OpenThread’s ability to maintain stable network connectivity when nodes join, leave, or change roles dynamically.
- Hardware Performance: Evaluate how different CPU architectures handle OpenThread networking tasks, including CPU utilization, memory usage, execution time, and power consumption.


## Tested /Devices

* Nordic nRF52840 
* Texas Instruments CC2652 
* Silicon Labs EFR32MG21 

| Type | Architecture        | Role                 |
|------|---------------------|----------------------|
| FTD  | Nordic (nRF52840)   | Border Router  & RCP |
|      |                     |                      |
| FTD  | Nordic (nRF52840)   | FED                  |
|      |                     | REED                 |
|      |                     | Router               |
|      |                     |                      |
| FTD  | Texas (CC2652)      | FED                  |
|      |                     | REED                 |
|      |                     | Router               |
|      |                     |                      |
| FTD  | Silicon (EFR32MG21) | FED                  |
|      |                     | REED                 |
|      |                     | Router               |

* promotions
- FED → REED: ( cannot promote  unless it was initially a REED).  
- REED → Router: (A REED can promote to Router if the network requires a new Router).
* demotions 
*  REED → FED: (A REED can be demoted to FED if it no longer qualifies to be promoted to Router
*  Router → FED: (A Router can be demoted to FED if it loses routing capabilities or becomes unnecessary).



In OpenThread, the Leader is NOT pre-assigned manually. Instead, it is dynamically elected based on network conditions.


Requirements :
✔ All three devices support OpenThread fully and run Zephyr OS in Docker.
✔ All three devices can be emulated in Renode for OpenThread testing.

✔ Keep only FTDs (Full Thread Devices) – No need for MTDs.
✔ Use REEDs instead of fixed Routers – This allows testing dynamic role transitions.
✔ nRF52840 acts as a Border Router in RCP mode – This enables network connectivity outside Thread.


-----------------------------------------------------------------------------------------------------------------------------

## Stages 

###  Step 1: Baseline Measurements 
Establish a stable network before introducing topology changes by evaluating OpenThread’s fundamental network & hardware performance.

#### Process (Step 1):
1. Deploy an initial OpenThread network with a fixed number of nodes (Routers, End Devices, and a Leader).
2. Allow the network to stabilize by ensuring:
  - Leader election occurs successfully.
  - Routing tables are fully synchronized.
  - IPv6 communication is functional and stable.
3. Profile hardware performance per architecture under normal network conditions.
4. Record baseline performance across all network & hardware metrics to establish a reference for later topology changes and scaling.

#### Metrics (Step 1):

### Baseline Metrics (Step 1)

| Inter. Test | Measurement                                  | Description                                                                    |
|-------------|----------------------------------------------|--------------------------------------------------------------------------------|
| (N, T)      | Leader Election Time                         | Measure initial Leader setup time.                                             |
| (N, T)      | Routing Table Consistency                    | Verify all nodes share synchronized route tables.                              |
| (N, T)      | Packet Delivery Ratio (PDR) During Changes   | Confirm stable packet transmission in steady-state conditions.                 |
| (N, T)      | Topology Convergence Time                    | Track how quickly routing tables stabilize after initial deployment.           |
| (N, T)      | RPL Route Establishment Time                 | Measure how long it takes for OpenThread to establish initial routing paths.   |
| (N, T)      | Multicast Message Propagation Time           | Evaluate how fast RPL control messages (DIO/DAO) propagate across the network. |
| (N, H)      | IPv6 Packet Forwarding Efficiency            | Validate that packets are correctly routed between nodes.                      |
| (N, H)      | 6LoWPAN Compression Efficiency               | Measure IPv6 header compression ratio to ensure optimized network overhead.    |
| (N, H)      | Latency Under Normal Conditions              | Establish baseline communication delay between nodes.                          |
| (H)         | CPU Utilization                              | Measure CPU load per architecture under normal conditions.                     |
| (H)         | Memory Usage (RAM)                           | Evaluate memory footprint differences between devices.                         |
| (H)         | Execution Time Per Task                      | Measure the time taken to process OpenThread tasks.                            |
| (H)         | Power Consumption                            | Estimate power usage via CPU cycles & execution time.                          |


------------------------------------------------------------------------------


### Step 2: Topology Scaling 
Evaluate OpenThread’s ability to dynamically scale the network while maintaining IPv6 routing, RPL consistency, 6LoWPAN compression efficiency, and hardware performance stability.

#### Process (Step2 ):
1. Incrementally add nodes and measure how quickly they integrate into the network.
2. Remove nodes one by one to observe how OpenThread reconfigures routing and communication paths.
3. Analyze network updates, protocol behaviors, and hardware resource usage:
  - IPv6: Ensure new nodes receive proper IPv6 addresses and can communicate without disruptions.
  - RPL: Validate that new routes are created, updated, and remain stable.
  - 6LoWPAN: Monitor packet compression efficiency as network size changes.
  - Seamless Communication: Ensure data flows without excessive delays or drops when nodes are added/removed.
  - Hardware Performance: Observe how CPU load, memory usage, execution time, and power consumption scale with node addition/removal.

### Measurements (Step 2)

| Inter. Test | Measurement                                | Description                                                                  |
|-------------|--------------------------------------------|------------------------------------------------------------------------------|
| (T, N)  | Topology Convergence Time                  | Measure how long it takes for new nodes to fully integrate.                  |
| (N, T)  | Packet Delivery Ratio (PDR) During Changes | Observe if packet loss increases when adding/removing nodes.                 |
| (T, N)  | Routing Table Consistency                  | Ensure all nodes correctly update their routing tables.                      |
| (N, T)  | IPv6 Address Assignment Time               | Measure how long it takes for new nodes to obtain IPv6 addresses.            |
| (N, T)  | RPL Route Update Time                      | Track how quickly RPL recalculates routes when nodes join/leave.             |
| (N, H)  | 6LoWPAN Compression Impact                 | Observe changes in compression efficiency when topology scales.              |
| (N, T)  | Multicast Propagation Delay                | Measure how long it takes for RPL DIO/DAO messages to reach all nodes.       |
| (T, H)  | Network Stability After Scaling            | Assess if performance degrades significantly due to scaling events.          |
| (H)     | CPU Utilization During Scaling             | Measure CPU load as the number of nodes increases/decreases.                 |
| (H)     | Memory Usage During Scaling                | Observe how memory usage fluctuates when nodes are added/removed.            |
| (H)     | Execution Time Per Task During Scaling     | Measure the time required to process OpenThread tasks as the network scales. |
| (H)     | Power Consumption Scaling Impact           | Track how power efficiency changes as more nodes join/leave.                 |

#### Identifying Failure Thresholds Process (Step 2)

| Inter. Test | Failure Category              | Description                                                      | Threshold Definition                                                |
|-------------|-------------------------------|------------------------------------------------------------------|---------------------------------------------------------------------|
| (N, T)      | IPv6 Address Failure          | New nodes fail to receive IPv6 addresses or route packets.       | Address allocation exceeds X sec or fails completely.               |
| (N, T)      | RPL Routing Failure           | Routing tables fail to converge after topology changes.          | RPL routes remain unstable beyond X sec after a change.             |
| (N, H)      | 6LoWPAN Compression Failure   | Compression efficiency degrades, increasing overhead.            | Compression ratio increases by X%, reducing efficiency.             |
| (N, T)      | Packet Delivery Failure (PDR) | Packet loss increases significantly as nodes are added/removed.  | Packet Delivery Ratio (PDR) drops below X%.                         |
| (T, H)      | Topology Scaling Breakdown    | Adding nodes leads to excessive latency or failed integration.   | Integration time exceeds X sec, or excessive retransmissions occur. |
| (H)         | CPU Saturation                | CPU utilization exceeds acceptable limits, causing delays.       | CPU usage surpasses X%, affecting packet processing.                |
| (H)         | Memory Exhaustion             | RAM usage increases to unsustainable levels, preventing scaling. | Memory utilization exceeds X%, limiting new node integration.       |
| (H)         | Execution Time Limit          | OpenThread processing slows due to increased load.               | Task execution exceeds X ms, impacting responsiveness.              |
| (H)         | Power Efficiency Breakdown    | Power consumption increases disproportionately with scaling.     | Power usage surpasses X mW, making the network inefficient.         |

------------------------------------------------------------------------------


### Step 3: Role Changes 
Evaluate how OpenThread maintains network stability, communication consistency, and hardware performance when nodes change roles dynamically (Leader, Router, End Device).

---

#### Process (Step3):
1. Force a Leader re-election by manually removing the current Leader.
2. Demote a Router to an End Device and observe how it affects routing and network stability.
3. Promote an End Device to a Router and measure how quickly it integrates and updates routing tables.
4. Observe network & hardware behavior during role transitions:
  - IPv6: Ensure devices retain correct addressing and forwarding capabilities after role changes.
  - RPL: Validate route recalculations and stability after role transitions.
  - 6LoWPAN: Check if compression efficiency remains stable after nodes shift roles.
  - Seamless Communication: Ensure data flows without significant disruption during transitions.
  - Hardware Performance: Track CPU load, memory usage, execution time, and power consumption when nodes change roles.

---

###  Measurements (Step 3)
| Inter. Test  | Measurement                                     | Description                                                                      |
|--------------|-------------------------------------------------|----------------------------------------------------------------------------------|
| (T, N)       | Leader Election Time                            | Measure how quickly the network elects a new Leader.                             |
| (N, T)       | Packet Delivery Ratio (PDR) During Role Changes | Observe if traffic disruption occurs when nodes switch roles.                    |
| (T, N)       | Routing Table Consistency                       | Ensure nodes update their routing tables correctly after role transitions.       |
| (N, H)       | IPv6 Address Retention & Forwarding Stability   | Verify that role changes do not disrupt IPv6 communication.                      |
| (N, T)       | RPL Route Adjustment Time                       | Measure how long it takes for RPL to stabilize after role changes.               |
| (N, H)       | 6LoWPAN Compression Impact                      | Evaluate whether role changes impact IPv6 compression efficiency.                |
| (N, T)       | Multicast Propagation Delay                     | Measure how long it takes for RPL control messages to reflect role transitions.  |
| (T, H)       | Network Recovery Time After Role Change         | Assess how long the network takes to regain full stability after transitions.    |
| (H)          | CPU Utilization During Role Change              | Measure CPU load when nodes switch roles (Router ↔ End Device).                  |
| (H)          | Memory Usage During Role Change                 | Observe how memory usage is affected when nodes change roles.                    |
| (H)          | Execution Time Per Role Change                  | Measure the time required for OpenThread tasks to process role transitions.      |
| (H)          | Power Consumption During Role Change            | Track how power efficiency is affected when nodes shift roles.                   |

---

#### Identifying Failure Thresholds Process (Step3) :   
Determine when OpenThread fails to maintain stable operations during dynamic role transitions.

| Inter. Test | Failure Category                  | Description                                                         | Threshold Definition                                          |
|-------------|-----------------------------------|---------------------------------------------------------------------|---------------------------------------------------------------|
| (N, T)      | IPv6 Address Failure              | Devices fail to retain correct IPv6 addresses after role change.    | Address reassignment takes X sec or fails completely.         |
| (N, T)      | RPL Routing Failure               | Routing tables fail to update after role changes.                   | RPL recalculations remain unstable beyond X sec.              |
| (N, H)      | 6LoWPAN Compression Failure       | Compression efficiency decreases, increasing transmission overhead. | Compression ratio increases by X%, reducing efficiency.       |
| (N, T)      | Packet Delivery Failure (PDR)     | Significant packet loss occurs when nodes change roles.             | Packet Delivery Ratio (PDR) drops below X%.                   |
| (T, H)      | Leader Election Failure           | Leader election takes too long, disrupting network stability.       | Election time exceeds X sec.                                  |
| (H)         | CPU Saturation                    | CPU overload impacts packet processing efficiency.                  | CPU usage surpasses X%, causing delays.                       |
| (H)         | Memory Exhaustion                 | Excessive RAM usage prevents role changes.                          | Memory utilization exceeds X%, limiting transitions.          |
| (H)         | Execution Time Limit              | OpenThread processing slows down due to role switching overhead.    | Task execution exceeds X ms, delaying transitions.            |
| (H)         | Power Efficiency Breakdown        | Power consumption increases disproportionately with role changes.   | Power usage surpasses X mW, making transitions unsustainable. |

------------------------------------------------------------------------------

### Step 4: Analysis & Conclusions

---
## Analysis per Interoperability Test Category
This section provides an in-depth evaluation based on Network (N), Topology (T), and Hardware (H) interoperability aspects, examining data from Step 2 (Topology Scaling) and Step 3 (Role Changes).

---

### Network (N) Analysis
Goal: Evaluate OpenThread’s IPv6, RPL, and 6LoWPAN protocol efficiency under dynamic conditions.

| Step         | Category                    | Analysis Focus                                                          | Key Insights                                                                 |
|--------------|-----------------------------|-------------------------------------------------------------------------|------------------------------------------------------------------------------|
| Step 2       | IPv6 Performance            | Address assignment delays, failures, and packet forwarding consistency. | Identify failures in address allocation time or incorrect packet forwarding. |
|              | RPL Routing Stability       | Route updates, table convergence, and control message propagation.      | Detect delays in RPL table updates or instability in routing paths.          |
|              | 6LoWPAN Compression         | Impact of scaling on IPv6 header compression efficiency.                | Identify inefficiencies where header compression overhead increases.         |
| Step 3       | IPv6 Stability              | Address retention & forwarding behavior during role changes.            | Determine if role changes cause packet misrouting or address loss.           |
|              | RPL Route Adaptation        | Route recalculations after role transitions.                            | Identify delays or failures in route re-establishment.                       |
|              | 6LoWPAN Efficiency          | Compression performance during frequent role transitions.               | Validate whether efficiency remains stable when nodes change roles.          |

---

### Topology (T) Analysis
Goal: Assess how OpenThread dynamically reconfigures itself in response to topology changes and role transitions.

| Step         | Category                              | Analysis Focus                                         | Key Insights                                                    |
|--------------|---------------------------------------|--------------------------------------------------------|-----------------------------------------------------------------|
| Step 2       | Topology Convergence Speed            | Network integration speed under increasing scale.      | Identify the network size limit where integration fails.        |
|              | Packet Delivery & Routing Consistency | Packet loss & routing table stability with more nodes. | Detect increased latency, instability, or failures.             |
| Step 3       | Leader Election Performance           | Compare election times across architectures.           | Identify whether one platform stabilizes the leader faster.     |
|              | Routing Table Updates                 | How quickly OpenThread propagates new routing info.    | Measure time to full topology stabilization after role changes. |

---

###  Hardware (H) Analysis
Goal: Evaluate and compare OpenThread execution across different hardware architectures.

| Step         | Category                | Analysis Focus                                          | Key Insights |
|-------------|------------------------|--------------------------------------------------------|--------------|
| Step 2  | CPU Utilization Trends | CPU load increase as the network scales. | Identify inefficiencies in scaling CPU resource usage. |
|             | Memory Usage Differences | RAM consumption changes with network size. | Detect memory exhaustion points and architectural differences. |
|             | Execution Time Per Task | OpenThread task execution time as nodes increase. | Measure whether response time degrades. |
|             | Power Consumption Variability | How power efficiency changes with scaling. | Identify architectures with lower energy efficiency. |
| Step 3  | CPU Load During Role Changes | CPU spikes when nodes switch roles. | Compare stress points between ARM & x86 architectures. |
|             | Memory Stability | RAM consumption during leader elections. | Identify potential memory overuse in role transitions. |
|             | Execution Time Variations | Processing delays after role transitions. | Measure how quickly OpenThread processes role changes. |
|             | Power Consumption During Role Changes | Energy impact of frequent role transitions. | Compare which architecture handles transitions more efficiently. |

---

### Final Considerations

| Question                                   | Relevance |
|-------------------------------------------|-----------|
| Which hardware performs best under network growth constraints? | Identify platform scalability limits. |
| Which architecture (ARM or x86) maintains the most stable routing performance? | Compare OpenThread performance in different environments. |
| Where do protocol inefficiencies (IPv6, RPL, 6LoWPAN) become bottlenecks? | Detect areas where protocol optimizations are needed. |
| Does power consumption scale efficiently, or does it increase disproportionately? | Evaluate sustainability of different architectures. |
| How does OpenThread recover from extreme topology changes and role transitions? | Assess fault tolerance in real-world deployment scenarios. |
